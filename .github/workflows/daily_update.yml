name: Daily update

on:
  workflow_dispatch:
  schedule:
    # UTC+8 0000
    - cron: "0 16 * * *"
    # UTC+8 0600
    - cron: "0 22 * * *"
    # UTC+8 1200
    - cron: "0 04 * * *"
    # UTC+8 1800
    - cron: "0 10 * * *"

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: "Checkout"
        uses: actions/checkout@v3
        with:
          token: ${{secrets.PAT}}
      - name: Scraping
        run: |
          cd tools && go run . && mv animad.json ../src/data/ && mv bilibili.json ../src/data/ && mv update.json ../src/data/ && cd ..
          git config --global user.name 'Js0n'
          git config --global user.email '29531167+JasonKhew96@users.noreply.github.com'
          git commit -am "Automated update"
          git push
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v1
        with:
          path: './src/'
  
  # Deploy job
  deploy:
    # Add a dependency to the build job
    needs: build

    # Grant GITHUB_TOKEN the permissions required to make a Pages deployment
    permissions:
      pages: write      # to deploy to Pages
      id-token: write   # to verify the deployment originates from an appropriate source

    # Deploy to the github-pages environment
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}

    # Specify runner + deployment step
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v2 # or the latest "vX.X.X" version tag for this action
